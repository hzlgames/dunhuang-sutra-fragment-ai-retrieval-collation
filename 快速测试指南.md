# FastAPI æ¥å£å¿«é€Ÿæµ‹è¯•æŒ‡å—

## ğŸ†• æ–°åŠŸèƒ½ï¼šæŸ¥çœ‹ AI å¤„ç†è¿‡ç¨‹

ç°åœ¨å¯ä»¥å®æ—¶æŸ¥çœ‹ AI çš„æ€è€ƒã€æ¨ç†å’Œå·¥å…·è°ƒç”¨è¿‡ç¨‹ï¼

### å¿«é€Ÿå¼€å§‹
```bash
# æäº¤ä»»åŠ¡å¹¶å®æ—¶ç›‘æ§
python monitor_process.py input/test0.png
```

è¯¦ç»†è¯´æ˜è¯·æŸ¥çœ‹ï¼š[æŸ¥çœ‹AIå¤„ç†è¿‡ç¨‹æŒ‡å—.md](æŸ¥çœ‹AIå¤„ç†è¿‡ç¨‹æŒ‡å—.md)

---

## å‰ææ¡ä»¶

1. **ç¡®ä¿æœåŠ¡æ­£åœ¨è¿è¡Œ**
   ```powershell
   python -m uvicorn src.api.server:app --host 0.0.0.0 --port 8000 --reload
   ```

2. **ç¡®è®¤æœ‰æµ‹è¯•å›¾ç‰‡**
   ```powershell
   # æŸ¥çœ‹å¯ç”¨çš„æµ‹è¯•å›¾ç‰‡
   Get-ChildItem -Path input -Recurse -Filter *.png
   ```

---

## æ–¹æ³•ä¸€ï¼šä½¿ç”¨ PowerShellï¼ˆcurl.exeï¼‰

### æµ‹è¯•å•ä»»åŠ¡æ¥å£

```powershell
# 1. æäº¤ä»»åŠ¡
curl.exe -X POST "http://127.0.0.1:8000/api/v1/jobs/image" -F "file=@input\test0.png"
# è®°å½•è¿”å›çš„ task_id

# 2. æŸ¥è¯¢çŠ¶æ€ï¼ˆæ›¿æ¢ä¸ºå®é™…çš„ task_idï¼‰
curl.exe "http://127.0.0.1:8000/api/v1/jobs/YOUR_TASK_ID"
```

### æµ‹è¯•æ‰¹å¤„ç†æ¥å£

```powershell
# 1. åˆ›å»ºæ‰¹å¤„ç†
curl.exe -X POST "http://127.0.0.1:8000/api/v1/batches" `
  -F "files=@input\test0.png" `
  -F "files=@input\temp\test_fragment.png"
# è®°å½•è¿”å›çš„ batch_id

# 2. æŸ¥è¯¢æ‰¹å¤„ç†çŠ¶æ€ï¼ˆæ›¿æ¢ä¸ºå®é™…çš„ batch_idï¼‰
curl.exe "http://127.0.0.1:8000/api/v1/batches/YOUR_BATCH_ID"

# 3. æŸ¥çœ‹æ‰¹å¤„ç†ç»“æœ
curl.exe "http://127.0.0.1:8000/api/v1/batches/YOUR_BATCH_ID/results"
```

---

## æ–¹æ³•äºŒï¼šä½¿ç”¨ Python æµ‹è¯•è„šæœ¬

### å®‰è£…ä¾èµ–
```bash
pip install requests
```

### æµ‹è¯•å•ä»»åŠ¡
```bash
python test_api.py --single input\test0.png
```

### æµ‹è¯•æ‰¹å¤„ç†
```bash
python test_api.py --batch input\test0.png input\temp\test_fragment.png
```

### æŒ‡å®šè‡ªå®šä¹‰ API åœ°å€
```bash
python test_api.py --single input\test0.png --url http://192.168.1.100:8000
```

---

## æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ Postman æˆ–æµè§ˆå™¨æ’ä»¶

### å•ä»»åŠ¡æ¥å£

**POST** `http://127.0.0.1:8000/api/v1/jobs/image`
- Method: `POST`
- Body: `form-data`
  - Key: `file` (type: File)
  - Value: é€‰æ‹©å›¾ç‰‡æ–‡ä»¶

**GET** `http://127.0.0.1:8000/api/v1/jobs/{task_id}`
- Method: `GET`
- æ›¿æ¢ `{task_id}` ä¸ºå®é™…å€¼

**GET** `http://127.0.0.1:8000/api/v1/jobs/{task_id}/process` ğŸ†•
- Method: `GET`
- è·å– AI å¤„ç†çš„ä¸­é—´è¿‡ç¨‹ï¼ˆæ€è€ƒã€å·¥å…·è°ƒç”¨ç­‰ï¼‰

### æ‰¹å¤„ç†æ¥å£

**POST** `http://127.0.0.1:8000/api/v1/batches`
- Method: `POST`
- Body: `form-data`
  - Key: `files` (type: File) - å¯æ·»åŠ å¤šä¸ª

**GET** `http://127.0.0.1:8000/api/v1/batches/{batch_id}`

**GET** `http://127.0.0.1:8000/api/v1/batches/{batch_id}/results`

**GET** `http://127.0.0.1:8000/api/v1/process/{session_id}` ğŸ†•
- Method: `GET`
- é€šè¿‡ session_id è·å–å¤„ç†è¿‡ç¨‹

---

## é¢„æœŸå“åº”æ ¼å¼

### å•ä»»åŠ¡ - æäº¤å“åº”
```json
{
  "task_id": "160d1eab-16c5-4e44-ba20-4b2c7a5aa3ea"
}
```

### å•ä»»åŠ¡ - çŠ¶æ€å“åº”ï¼ˆè¿è¡Œä¸­ï¼‰
```json
{
  "task_id": "160d1eab-16c5-4e44-ba20-4b2c7a5aa3ea",
  "status": "RUNNING",
  "created_at": "2025-12-03T11:20:03.288226",
  "updated_at": "2025-12-03T11:20:03.295040",
  "result": null,
  "error": null
}
```

### å•ä»»åŠ¡ - çŠ¶æ€å“åº”ï¼ˆæˆåŠŸï¼‰
```json
{
  "task_id": "160d1eab-16c5-4e44-ba20-4b2c7a5aa3ea",
  "status": "SUCCEEDED",
  "created_at": "2025-12-03T11:20:03.288226",
  "updated_at": "2025-12-03T11:25:15.123456",
  "result": {
    "fragment_type": "sutra",
    "confidence": "high",
    "source_work": {...},
    "matched_passages": [...],
    "translations": {...}
  },
  "error": null
}
```

### æ‰¹å¤„ç† - åˆ›å»ºå“åº”
```json
{
  "batch_id": "d9a4d4e3-25b0-404b-a13e-38ad2a54ecc5"
}
```

### æ‰¹å¤„ç† - çŠ¶æ€å“åº”
```json
{
  "batch_id": "d9a4d4e3-25b0-404b-a13e-38ad2a54ecc5",
  "status": "BATCH_RUNNING",
  "round": 2,
  "total_jobs": 2,
  "completed_jobs": 1,
  "failed_jobs": 0,
  "details": [
    {
      "session_id": "80e49e56-b955-4f9c-958c-4593c12b81f2",
      "alias": "test0_80e49e56",
      "done": true,
      "error": null,
      "last_round": 3
    },
    {
      "session_id": "23d727a0-a8bc-4e0a-bc30-b314265cc6e5",
      "alias": "test_fragment_23d727a0",
      "done": false,
      "error": null,
      "last_round": 2
    }
  ]
}
```

---

## å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ï¼šcurl å‘½ä»¤ä¸è¯†åˆ« -X å‚æ•°
**åŸå› **: PowerShell çš„ curl æ˜¯åˆ«åï¼Œä¸æ”¯æŒæ ‡å‡† curl å‚æ•°  
**è§£å†³**: ä½¿ç”¨ `curl.exe` è€Œä¸æ˜¯ `curl`

### é—®é¢˜ï¼šæ–‡ä»¶è·¯å¾„é”™è¯¯
**åŸå› **: Windows ä½¿ç”¨åæ–œæ  `\`ï¼Œä¸æ˜¯æ­£æ–œæ  `/`  
**è§£å†³**: ä½¿ç”¨ `input\test0.png` è€Œä¸æ˜¯ `input/test0.png`

### é—®é¢˜ï¼šçŠ¶æ€ä¸€ç›´æ˜¯ RUNNING
**å¯èƒ½åŸå› **:
1. Gemini API è¿‡è½½ï¼ˆ503 é”™è¯¯ï¼‰- ç¨åé‡è¯•
2. ç½‘ç»œé—®é¢˜ - æ£€æŸ¥ç½‘ç»œè¿æ¥
3. API Key é…ç½®é—®é¢˜ - æ£€æŸ¥ `.env` æ–‡ä»¶

**æŸ¥çœ‹æ—¥å¿—**: æŸ¥çœ‹è¿è¡Œ uvicorn çš„ç»ˆç«¯çª—å£ï¼Œçœ‹æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

### é—®é¢˜ï¼šæ‰¹å¤„ç†ç«‹å³å¤±è´¥
**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥æœåŠ¡å™¨ç»ˆç«¯æ—¥å¿—
2. ç¡®è®¤å›¾ç‰‡æ–‡ä»¶æ ¼å¼æ­£ç¡®ï¼ˆPNG/JPGï¼‰
3. ç¡®è®¤å›¾ç‰‡æ–‡ä»¶å¤§å°åˆç†ï¼ˆ< 10MBï¼‰
4. æ£€æŸ¥ Gemini API é…é¢æ˜¯å¦ç”¨å®Œ

---

## éªŒè¯æœ¬åœ°è¾“å‡ºæ–‡ä»¶

å½“ä»»åŠ¡æˆåŠŸå®Œæˆåï¼Œæ£€æŸ¥ä»¥ä¸‹ç›®å½•ï¼š

```powershell
# æŸ¥çœ‹è¾“å‡ºæ–‡ä»¶
Get-ChildItem -Path output -Filter *.json
Get-ChildItem -Path output -Filter *.txt

# æŸ¥çœ‹ä¼šè¯è®°å½•
Get-ChildItem -Path sessions -Filter *.json
Get-ChildItem -Path sessions -Filter *.jsonl
```

**é¢„æœŸæ–‡ä»¶**:
- `output/{å›¾ç‰‡å}_result.json` - ç»“æ„åŒ–ç»“æœ
- `output/{å›¾ç‰‡å}_report.txt` - æ–‡æœ¬æŠ¥å‘Š
- `output/{å›¾ç‰‡å}_note.txt` - æ³¨é‡Šè¯´æ˜
- `sessions/{session_id}.rounds.jsonl` - è½®æ¬¡è®°å½•

---

## æ€§èƒ½æµ‹è¯•å»ºè®®

### å•ä»»åŠ¡æ€§èƒ½
- å…¸å‹å¤„ç†æ—¶é—´ï¼š30-120 ç§’ï¼ˆå–å†³äºç¢ç‰‡å¤æ‚åº¦ï¼‰
- è½®æ¬¡æ•°ï¼šé€šå¸¸ 2-5 è½®
- å·¥å…·è°ƒç”¨ï¼šCBETA æœç´¢ã€Gallica æ£€ç´¢

### æ‰¹å¤„ç†æ€§èƒ½
- æ¯è½®å¤„ç†æ—¶é—´ï¼šæ¯”å•ä»»åŠ¡ç•¥é•¿ï¼ˆå¹¶å‘è°ƒç”¨ï¼‰
- å»ºè®®æ‰¹æ¬¡å¤§å°ï¼š2-10 å¼ å›¾ç‰‡
- æ€»è€—æ—¶ï¼šçº¦ å•ä»»åŠ¡æ—¶é—´ Ã— 1.2-1.5

---

## ä¸‹ä¸€æ­¥å»ºè®®

1. **ç­‰å¾… Gemini API æ¢å¤åé‡æ–°æµ‹è¯•**
2. **æµ‹è¯•æ›´å¤šè¾¹ç•Œæƒ…å†µ**ï¼ˆç©ºæ–‡ä»¶ã€è¶…å¤§æ–‡ä»¶ç­‰ï¼‰
3. **ç›‘æ§é•¿æ—¶é—´è¿è¡Œçš„æ‰¹å¤„ç†ä»»åŠ¡**
4. **æµ‹è¯•å¹¶å‘è¯·æ±‚çš„å¤„ç†èƒ½åŠ›**

